// safeapp.js - Secure Design Example (Fix for CWE-862: Missing Authorization)
const express = require('express');
const app = express();

const sensitiveData = {
    admin: ['user1', 'user2', 'user3'],
    user: ['user3', 'user4']
};

// Simulated user session (normally from login session/cookie)
const loggedInUser = {
    username: 'bob',
    role: 'user'  // Change to 'admin' to simulate an admin login
};

// âœ… Enforce role-based access control
app.get('/data', (req, res) => {
    const requestedRole = req.query.user;

    if (!requestedRole || !sensitiveData[requestedRole]) {
        return res.status(400).send('Invalid role specified');
    }

    // Allow access only to your own role (or admin)
    if (loggedInUser.role === requestedRole || loggedInUser.role === 'admin') {
        res.json(sensitiveData[requestedRole]);
    } else {
        res.status(403).send('Access denied');
    }
});

app.listen(3000, () => {
    console.log('Secure app running at http://localhost:3000');
});
